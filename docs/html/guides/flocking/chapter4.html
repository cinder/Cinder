<!DOCTYPE html>
<html><head>
    <meta charset="utf-8"/>
    <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>

    <title></title> <!-- dynamic partial defined in python -->
    

    <link href="../../_assets/css/foundation.css" rel="stylesheet"/>
    <link href="../../_assets/css/prism.css" rel="stylesheet" type="text/css"/>
    <link href="../../_assets/css/treeview.css" rel="stylesheet" type="text/css"/>
    <link href="../../_assets/css/cinder_docs.css" rel="stylesheet" type="text/css"/>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700" rel="stylesheet" type="text/css"/>
    <link href="http://fonts.googleapis.com/css?family=Libre+Baskerville:400,400italic" rel="stylesheet" type="text/css"/>

</head>
<body class="guide language-cpp">

    <!-- start offcanvas content for responsive sliding nav -->
    <div class="off-canvas-wrap wrapper" data-offcanvas="">
        <main class="inner-wrap">

            <section class="main-section">

                <!-- top section -->
                <div id="top-primary">
                    <!-- main nav -->
                    
                    <nav class="show-for-medium-up content row top-bar" data-topbar="" id="main-nav" role="navigation">
                      <div class="branding columns medium-4 large-3">
                        <div class="navbar-header">
                          <a class="navbar-brand" href="../../index.html"></a><div class="cinder-version">0.9.0</div>
                        </div>
                      </div>

                    <div class="columns medium-8 large-9">
                        <section class="top-bar-section">
                            <!-- Right Nav Section -->
                            <ul class="right">
                              <li class="active">
                                    </li><li id="nav_search">
                                    <div id="search">
                                            <input id="search-input" type="text"/>
                                            <div id="search-results"></div>
                                        </div>
                                        <script src="../../search_index.js" type="text/javascript"></script>
                                  </li>
                              
                            </ul>

                            <!-- Left Nav Section -->
                            
                            <ul class="tablist nav">
                              <li class="" id="nav_reference">
                                <a href="../../reference/geometry.html">Reference</a></li>
                              <li class="active" id="nav_guides">
                                <a href="../index.html">Guides</a></li>
                              <li class="" id="nav_namespaces">
                                <a href="../../namespaces.html">Namespaces</a></li>
                              <li class="" id="nav_classes">
                                <a href="../../classes.html">
                                  Classes</a></li>
                            </ul>
                        </section>
                      </div>
                    </nav>

                    <!-- for any additional content you'd want to put up here -->
                    
                </div>

                <!-- mobile nav -->
                <nav class="tab-bar show-for-small">
                  <section class="left-small">
                    <a class="left-off-canvas-toggle menu-icon" href="#"><span></span></a>
                  </section>

                  <section class="middle tab-bar-section">
                    <h2 class="title">Cinder</h2>
                  </section>

                </nav>

                <aside class="left-off-canvas-menu">
                  <ul class="off-canvas-list">
                    <li><label>Cinder Documentation</label></li>
                    <li id="nav_reference"><a href="../../reference/index.html">Reference</a></li>
                    <li id="nav_guides"><a href="../index.html">Guides</a></li>
                    <li id="nav_namespaces"><a href="../../namespaces.html">Namespaces</a></li>
                    <li id="nav_classes"><a href="../../classes.html">Classes</a></li>
                    <li><a href="http://libcinder.org/download/">Download</a></li>
                  </ul>
                </aside>
                
                
                <div data-equalizer="content" id="main-content">

                    
<div class="row content content-row" id="container">
    <div class="columns large-3">

    </div>

    <div class="columns large-9 content" data-equalizer-watch="content">


    

    <div class="textblock"><h1><a class="anchor" id="alignment"></a>
    RULE 3: ALIGNMENT</h1>
    <p><br/>
    </p><div class="image">
    <img alt="rule3.jpg" src="images/rule3.jpg"/>
    </div>
    <p> <br/>
     <br/>
    It is time to introduce the third rule. As you recall, the first rule was an act of separation. If an object gets too crowded, it tries to move away from its neighbors. The second rule is an act of cohesion. If an object moves too far away, it tries to move towards its neighbors. These two rules alone are enough to make some interesting flocking simulations. The resulting look is not too dissimilar from how tiny winged insects behave: a seemingly chaotic wandering but still exhibiting some group behavior. <br/>
     <br/>
    Rule 3 gets us to a more familiar and less random looking system. This rule says that if a neighbor is not too far away or too close, then emulate its velocity. Or in other words, move like your neighbors move. <br/>
     <br/>
    Let's bring back the <em>applyForce()</em> method to see what changes were made to accommodate this new third zone. <br/>
     <br/>
     
    </p><div class="fragment"><pre class="fragment"><span style="font-size: x-small; line-height: 1px;">void ParticleController::applyForce( float zoneRadiusSqrd, float lowThresh, float highThresh  )
    {
        for( list::iterator p1 = mParticles.begin(); p1 != mParticles.end(); ++p1 ) {
            list::iterator p2 = p1;
            for( ++p2; p2 != mParticles.end(); ++p2 ) {
                Vec3f dir = p1-&gt;mPos - p2-&gt;mPos;
                float distSqrd = dir.lengthSquared();

                if( distSqrd &lt; zoneRadiusSqrd ) { <span style="color: #888888;">// If the neighbor is within the zone radius...</span>
                    float percent = distSqrd/zoneRadiusSqrd;

                    if( percent &lt; lowThresh ) { <span style="color: #888888;">// ... and is within the lower threshold limits, separate...</span>
                        <span style="color: #3366ff;">float F = ( lowThresh/percent - 1.0f ) * 0.01f;
                        dir = dir.normalize() * F;
                        p1-&gt;mAcc += dir;
                        p2-&gt;mAcc -= dir;</span>
                    }
                    else if( percent &lt; highThresh ) { <span style="color: #888888;">// ... else if it is within the higher threshold limits, align...</span>
                        <span style="color: #008000;">float threshDelta = highThresh - lowThresh;
                        float adjustedPercent = ( percent - lowThresh )/threshDelta;
                        float F = ( 0.5f - cos( adjustedPercent * M_PI * 2.0f ) * 0.5f + 0.5f ) * 0.01f;
                        p1-&gt;mAcc += p2-&gt;mVel.normalized() * F;
                        p2-&gt;mAcc += p1-&gt;mVel.normalized() * F;</span>
                    }
                    else { <span style="color: #888888;">// ... else, attract.</span>
                        <span style="color: #ff0000;">float threshDelta = 1.0f - highThresh;
                        float adjustedPercent = ( percent - highThresh )/threshDelta;
                        float F = ( 0.5f - cos( adjustedPercent * M_PI * 2.0f ) * 0.5f + 0.5f ) * 0.01f;
                        dir = dir.normalize() * F;
                        p1-&gt;mAcc -= dir;
                        p2-&gt;mAcc += dir;</span>
                    }
                }
            }
        }
    }</span></pre></div>
    <p></p>
    <p><br/>
    The orientation force is similar to what we are doing with the cohesive force. We normalize the Particle's position within the range which it finds itself, and then use that normalized position to find the position along the inverted cosine. Here is what our curve now looks like. <br/>
     <br/>
    </p><div class="image">
    <img alt="curve3.jpg" src="images/curve3.jpg"/>
    </div>
    <p> <br/>
     <br/>
    There is another difference with the alignment force that is different from separation and cohesion forces. The alignment force doesn't care about the vector between the interacting particles. It is more interested in the other particle's current velocity. This is why we are referencing <em>mVel</em> of the other Particle instead of manipulating the <em>dir</em> vector between Particles. If you are not too close to me and not too far away from me, I want to start moving in the direction you are moving. This simple process is what helps to create group flocking behavior in a random collection of particles with random starting positions and random starting velocities. <br/>
     <br/>
    When you run the Chapter 4 Flocking app, you will get a random mess of particles but after a couple seconds, groups will begin to form. <br/>
     <br/>
    </p><div class="image">
    <img alt="chapter4b.jpg" src="images/chapter4b.jpg"/>
    </div>
    <p> <br/>
     <br/>
    It is not uncommon for the flocking Particles to begin to form vortices that are characteristic of many species of fish. In the image below, thousands of sardines swim into a tight formation known as a <a href="http://en.wikipedia.org/wiki/Shoaling_and_schooling">bait ball</a> which is a type of shoaling. <br/>
     <br/>
    </p><div class="image">
    <img alt="3706256557_a98ab377d1_b.jpg" src="images/3706256557_a98ab377d1_b.jpg"/>
    </div>
    <p><em>Photo credit: Erwin Poliakoff (Flickr:epddiver)</em> <br/>
    <br/>
    </p><div class="image">
    <img alt="chapter4a.jpg" src="images/chapter4a.jpg"/>
    </div>
    <p> <br/>
     <br/>
    There you have it. A fairly basic 3D flocking particle simulation. In <a class="el" href="chapter5.html">Flocking Chapter 5</a>, we are going to show different ways you can improve the behavior of the flocking and also add in a few predators.</p>
    <p><br/>
    </p>
    </div>


  
  </div>

</div> <!-- dynamic partial defined in python -->
                </div> 
            </section>
            
            <a class="exit-off-canvas"></a>
        </main>

        <footer>
          <div class="row">&copy;Copyright 2015 <a href="http://www.libcinder.org">Cinder</a></div>
        </footer>

    </div>
    
    

    
    <script src="../../_assets/js/jquery.js" type="text/javascript"></script>
    <script src="../../_assets/js/foundation.min.js" type="text/javascript"></script>
    <script src="../../_assets/js/prism.js" type="text/javascript"></script>
    <script src="../../_assets/js/lunr.min.js" type="text/javascript"></script>
    <script src="../../_assets/js/lunr.min.js" type="text/javascript"></script>
    <script src="../../search_index.js" type="text/javascript"></script>
    <script src="../../_assets/js/cinder.js" type="text/javascript"></script>

    <script type="text/javascript">
        // Calling foundation runs through any calls
        // related to foundation 5.
        // One such thing is making sure the column sizes stay in sync
        // $(document).foundation();
        $(document).foundation('offcanvas', 'reflow');
    </script>


</body></html>